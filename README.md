# YOLO物体検出アプリケーション

YOLOv8を使用したリアルタイム物体検出と可視化ツールです。StreamlitベースのWebアプリケーションとして構築されており、画像アップロードから検出結果の可視化まで、一連のワークフローを提供します。

## 機能概要

### 主要機能
- **リアルタイム物体検出**: YOLOv8を使用した高速物体検出
- **マルチクラス検出**: 80種類のCOCOクラスに対応
- **可視化機能**: 検出結果の詳細な可視化と統計情報
- **設定可能**: 信頼度閾値やNMS閾値の調整
- **統計分析**: 検出結果の統計情報とクラス別分析

### 技術仕様
- **フレームワーク**: Streamlit
- **モデル**: YOLOv8 (Ultralytics)
- **バックエンド**: PyTorch
- **可視化**: OpenCV, Matplotlib, Seaborn
- **対応形式**: JPG, PNG, JPEG
- **言語**: 日本語対応

## アプリケーション構成

### ファイル構造
```
yoro_app/
├── app.py                 # メインアプリケーションファイル
├── yolo_model_manager.py  # YOLOモデル管理クラス
├── yolo_visualization.py  # YOLOv8可視化機能
├── ui_components.py       # UIコンポーネント
├── pyproject.toml         # プロジェクト設定
└── README.md             # このファイル
```

### モジュール説明

#### app.py
メインのStreamlitアプリケーション。以下のタブで構成されています：
- **物体検出タブ**: 画像アップロードと検出実行
- **可視化タブ**: YOLOv8アーキテクチャの可視化
- **統計タブ**: 検出結果の統計分析
- **情報タブ**: アプリケーション情報と使用方法

#### yolo_model_manager.py
YOLOモデルの管理を担当：
- モデルのロードと初期化
- 物体検出の実行
- 結果の後処理
- エラーハンドリング

#### yolo_visualization.py
YOLOv8の可視化機能：
- 処理フロー図の生成
- アーキテクチャ図の作成
- 詳細比較図の表示
- 技術仕様の可視化

#### ui_components.py
再利用可能なUIコンポーネント：
- 画像アップロードコンポーネント
- 検出結果表示コンポーネント
- モデル設定コンポーネント
- 統計情報表示コンポーネント

## 処理フロー

### 1. アプリケーション起動フロー
```
ユーザーがアプリケーションにアクセス
    ↓
Streamlitアプリケーション初期化
    ↓
YOLOAppクラスのインスタンス化
    ↓
UIコンポーネントの初期化
    ↓
セッション状態の初期化
    ↓
メインインターフェースの表示
```

### 2. 物体検出フロー
```
ユーザーが画像をアップロード
    ↓
画像の前処理と検証
    ↓
YOLOモデルのロード（初回のみ）
    ↓
物体検出の実行
    ↓
検出結果の後処理
    ↓
結果の可視化と統計情報の生成
    ↓
ユーザーへの結果表示
```

### 3. 可視化フロー
```
ユーザーが可視化タブを選択
    ↓
可視化タイプの選択（処理フロー図/アーキテクチャ図/詳細比較図）
    ↓
対応する可視化関数の実行
    ↓
matplotlib Figureの生成
    ↓
Streamlitでの表示
```

## YOLOv8アーキテクチャ

### 処理フロー図
```
画像入力 (640x640x3)
    ↓
バックボーン (CSPDarknet)
    ↓
Neck (PANet - FPN + PAN)
    ↓
Head (Anchor-Free)
    ↓
検出結果 (バウンディングボックス + クラス)
```

### 詳細アーキテクチャ
```
入力層: 640x640x3 RGB画像
    ↓
バックボーン層:
  - C2f層 (4段階)
  - SPPF層
    ↓
Neck層:
  - FPN (Feature Pyramid Network)
  - PAN (Path Aggregation Network)
    ↓
Head層:
  - Detection Head
  - Classification Head
  - Regression Head
    ↓
出力層: 検出結果
```

### Neck構造の詳細

#### FPN (Feature Pyramid Network)
- **役割**: 異なるスケールの特徴マップを生成
- **構造**: 上向きの特徴融合（Bottom-up pathway）
- **効果**: 小物体から大物体まで検出可能

#### PAN (Path Aggregation Network)
- **役割**: FPNに加えて下向きの特徴融合
- **構造**: 下向きの特徴融合（Top-down pathway）
- **効果**: より豊富な特徴表現と小物体検出性能向上

#### PANet (FPN + PAN)の完全構造
```
バックボーン出力
    ↓
FPN (上向き融合):
  P3 ← C3 (高解像度)
  P4 ← C4 + P3↑ (中解像度)
  P5 ← C5 + P4↑ (低解像度)
    ↓
PAN (下向き融合):
  N5 ← P5 (低解像度)
  N4 ← P4 + N5↓ (中解像度)
  N3 ← P3 + N4↓ (高解像度)
    ↓
Head (検出ヘッド)
```

#### 他のNeck構造との比較
| Neck構造 | 特徴 | 精度 | 速度 | メモリ |
|----------|------|------|------|--------|
| FPN | 上向き融合のみ | 基準 | 基準 | 基準 |
| PANet | FPN + PAN | +15% | -10% | +15% |
| BiFPN | 双方向融合 | +20% | -15% | +20% |

**PANetの利点:**
- マルチスケール検出性能の向上
- 小物体検出精度の20-30%向上
- 特徴の効率的な再利用
- 精度と速度の良好なバランス

## 使用方法

### 1. 環境セットアップ
```bash
# プロジェクトディレクトリに移動
cd yoro_app

# 依存関係のインストール
pip install -e .
```

### 2. アプリケーション起動
```bash
# Streamlitアプリケーションを起動
streamlit run app.py
```

### 3. 物体検出の実行
1. **画像アップロード**: 検出したい画像をアップロード
2. **設定調整**: サイドバーで検出パラメータを調整
   - 信頼度閾値: 0.0-1.0
   - NMS閾値: 0.0-1.0
3. **検出実行**: 「検出を実行」ボタンをクリック
4. **結果確認**: 検出結果と統計情報を確認

### 4. 可視化の確認
- **処理フロー図**: YOLOv8の処理ステップを視覚化
- **アーキテクチャ図**: 詳細なネットワーク構造を表示
- **詳細比較図**: モデルサイズ別の性能比較

## 設定オプション

### モデル設定
- **モデルサイズ**: nano, small, medium, large, xlarge
- **デバイス**: CPU, GPU (利用可能な場合)

### 検出設定
- **信頼度閾値**: 検出結果の信頼度フィルタリング
- **NMS閾値**: 重複検出の除去閾値

### 可視化設定
- **ラベル表示**: クラス名の表示/非表示
- **信頼度表示**: 信頼度スコアの表示/非表示
- **バウンディングボックス**: 検出枠の表示/非表示

## 性能指標

### YOLOv8モデル比較
| モデル | パラメータ数 | mAP@0.5 | FPS (GPU) | 用途 |
|--------|-------------|---------|-----------|------|
| YOLOv8n | 3.2M | 0.637 | 115 | エッジデバイス |
| YOLOv8s | 11.2M | 0.718 | 85 | 一般的用途 |
| YOLOv8m | 25.9M | 0.764 | 52 | サーバー用途 |
| YOLOv8l | 43.7M | 0.792 | 39 | 高精度用途 |
| YOLOv8x | 68.2M | 0.814 | 28 | 研究用途 |

### 技術仕様
- **入力サイズ**: 640x640ピクセル
- **アーキテクチャ**: CSPDarknet + PANet + Anchor-Free Head
- **損失関数**: BCE + CIoU + DFL
- **最適化器**: AdamW
- **学習率**: 0.01（自動調整）

## エラーハンドリング

### 一般的なエラーと対処法
1. **モデルロードエラー**: インターネット接続を確認
2. **メモリ不足**: より小さいモデルサイズを選択
3. **画像形式エラー**: 対応形式（JPG, PNG, JPEG）を確認
4. **検出失敗**: 信頼度閾値を下げて再試行

## 開発情報

### 依存関係
- streamlit >= 1.28.0
- ultralytics >= 8.0.0
- torch >= 2.0.0
- opencv-python >= 4.8.0
- matplotlib >= 3.7.0
- seaborn >= 0.12.0
- pillow >= 10.0.0
- numpy >= 1.24.0

### 開発環境
- Python 3.8以上
- Streamlit 1.28.0以上
- PyTorch 2.0.0以上

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

バグ報告や機能要望は、GitHubのIssueページでお知らせください。

## 更新履歴

- v1.0.0: 初期リリース
  - YOLOv8物体検出機能
  - StreamlitベースのWebインターフェース
  - 可視化機能
  - 統計分析機能 